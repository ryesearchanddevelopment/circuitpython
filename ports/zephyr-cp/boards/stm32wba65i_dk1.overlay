&flash0 {
    /delete-node/ partitions;

    partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		boot_partition: partition@0 {
			label = "mcuboot";
			reg = <0x00000000 DT_SIZE_K(64)>;
		};

		slot0_partition: partition@10000 {
			label = "image-0";
			reg = <0x00010000 DT_SIZE_K(928)>;
		};

		storage_partition: partition@f80000 {
			label = "storage";
			reg = <0x001e0000 DT_SIZE_K(64)>;
		};

        circuitpy_partition: partition@108000 {
            label = "circuitpy";
            reg = <0x00108000 DT_SIZE_K(992)>;
        };
    };
};

&rng {
    status = "okay";
};

/*
 * USB on STM32WBA requires VOS Range 1. Zephyr selects VOS from HCLK, and
 * 16 MHz keeps it in Range 2, which trips an assertion in udc_stm32.
 * Run SYSCLK from full 32 MHz HSE so VOS is set to Range 1.
 */
&clk_hse {
	/delete-property/ hse-div2;
};

&rcc {
	clock-frequency = <DT_FREQ_M(32)>;
	ahb5-prescaler = <1>;
};

zephyr_udc0: &usbotg_hs {
	clocks = <&rcc STM32_CLOCK(AHB2, 14)>,
		 <&rcc STM32_SRC_HSE OTGHS_SEL(0)>;
	pinctrl-0 = <&usb_otg_hs_dm_pd7 &usb_otg_hs_dp_pd6>;
	pinctrl-names = "default";
	status = "okay";
};

&otghs_phy {
	/* OTG HS clock source is 32 MHz HSE */
	clock-reference = "SYSCFG_OTG_HS_PHY_CLK_32MHz";
	status = "okay";
};

#include "../app.overlay"
